<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Precision Answer Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6C5CE7',
                        secondary: '#00CEC9',
                        accent: '#FD79A8',
                        yellow: '#FDCB6E',
                        dark: '#2D3436',
                        light: '#DFE6E9',
                    },
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                    },
                    animation: {
                        float: 'float 20s infinite alternate',
                        popIn: 'popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        pulseCustom: 'pulseCustom 1.5s infinite',
                        fadeIn: 'fadeIn 0.4s ease-out',
                    },
                    keyframes: {
                        float: {
                            '0%': { transform: 'translate(0, 0)' },
                            '100%': { transform: 'translate(30px, 50px)' },
                        },
                        popIn: {
                            'from': { transform: 'scale(0.8)', opacity: '0' },
                            'to': { transform: 'scale(1)', opacity: '1' },
                        },
                        pulseCustom: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.1)' },
                        },
                        fadeIn: {
                            'from': { opacity: '0', transform: 'scale(0.95)' },
                            'to': { opacity: '1', transform: 'scale(1)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.6);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }
    </style>
</head>

<body
    class="bg-gradient-to-br from-[#74b9ff] to-[#a29bfe] min-h-screen w-full overflow-hidden font-sans select-none m-0 p-0">

    <!-- Animated Background -->
    <div
        class="absolute w-[400px] h-[400px] bg-[#ffeaa7]/40 rounded-full blur-[60px] -top-24 -left-24 animate-float z-0">
    </div>
    <div class="absolute w-[500px] h-[500px] bg-[#55efc4]/30 rounded-full blur-[60px] -bottom-36 -right-24 animate-float z-0"
        style="animation-delay: -5s;"></div>

    <!-- Transition Overlay -->
    <div id="overlay"
        class="fixed inset-0 bg-primary z-[9999] translate-y-full transition-transform duration-[600ms] ease-[cubic-bezier(0.77,0,0.175,1)] flex flex-col justify-center items-center text-white text-4xl md:text-5xl font-black text-center px-5">
        <span id="overlay-text">SIAP... üöÄ</span>
    </div>

    <!-- Main App Container -->
    <div id="main-app" class="relative w-full h-screen flex justify-center items-center z-10">

        <!-- MENU SCREEN -->
        <div id="screen-menu"
            class="screen hidden opacity-0 transition-opacity duration-500 flex-col items-center justify-center w-full h-screen p-5">
            <div
                class="glass-card w-full md:w-auto md:min-w-[600px] md:max-w-2xl rounded-3xl md:rounded-[40px] shadow-2xl p-8 md:p-10 flex flex-col items-center justify-center relative animate-popIn">
                <div class="text-center mb-6">
                    <h1 class="text-4xl md:text-5xl font-black text-primary mb-3 tracking-tight drop-shadow-sm">
                        Precision Answer Edition</h1>
                    <p class="text-base md:text-lg text-gray-500 mb-6">Asah otakmu dengan pola seru!</p>
                </div>

                <div class="w-full max-w-md flex flex-col gap-4 mb-6">
                    <input type="text" id="nama" placeholder="Siapa namamu?" autocomplete="off"
                        class="w-full p-4 md:p-5 border-2 border-light rounded-2xl text-lg text-dark bg-white outline-none focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all">
                    <select id="kelas"
                        class="w-full p-4 md:p-5 border-2 border-light rounded-2xl text-lg text-dark bg-white outline-none focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all appearance-none cursor-pointer">
                        <option value="" disabled selected>Pilih Kelas</option>
                        <option value="1A">Kelas 1A</option>
                        <option value="1B">Kelas 1B</option>
                        <option value="2A">Kelas 2A</option>
                        <option value="2B">Kelas 2B</option>
                    </select>
                </div>

                <div class="flex gap-4 flex-wrap justify-center mb-6">
                    <button onclick="mulai()"
                        class="bg-primary text-white px-10 py-4 text-xl font-extrabold rounded-full shadow-lg hover:-translate-y-1 hover:shadow-primary/40 active:scale-95 transition-all flex items-center gap-2">
                        MULAI MAIN ‚ñ∂
                    </button>
                    <button onclick="tutupAplikasi()"
                        class="bg-[#ff7675] text-white px-10 py-4 text-xl font-extrabold rounded-full shadow-lg hover:-translate-y-1 hover:shadow-[#ff7675]/40 active:scale-95 transition-all flex items-center gap-2">
                        KELUAR ‚úï
                    </button>
                </div>

                <div class="text-sm text-gray-400">
                    v2.0 Precision Edition
                </div>
            </div>
        </div>

        <!-- GAME SCREEN -->
        <div id="screen-game"
            class="screen hidden opacity-0 transition-opacity duration-500 flex-col items-center justify-center w-full h-screen p-5">
            <div
                class="glass-card w-full md:w-auto md:min-w-[800px] md:max-w-4xl rounded-3xl md:rounded-[40px] shadow-2xl p-5 md:p-10 flex flex-col items-center justify-start relative animate-popIn max-h-[90vh]">
                <button onclick="goHome()"
                    class="absolute top-5 left-5 bg-white text-dark px-5 py-2.5 text-base rounded-2xl shadow-sm hover:shadow-md transition-all z-20 font-bold">
                    üè† Menu
                </button>

                <div class="text-center mt-12 md:mt-2">
                    <span
                        class="bg-yellow text-dark px-6 py-2 rounded-full font-extrabold text-xl shadow-md inline-block mb-5">
                        LEVEL <span id="level-display">1</span>
                    </span>
                    <span id="hots-badge"
                        class="hidden bg-[#ff7675] text-white px-4 py-1 rounded-full text-sm font-bold ml-2 shadow-sm">
                        üî• TANTANGAN
                    </span>
                </div>

                <div class="flex-1 w-full flex flex-col justify-center overflow-y-auto">
                    <div id="soal-area"
                        class="bg-white rounded-2xl md:rounded-[30px] p-4 md:p-8 w-full min-h-[180px] md:min-h-[220px] flex flex-row justify-center items-center gap-3 md:gap-6 mb-6 shadow-inner overflow-x-auto no-scrollbar">
                        <!-- Pola akan muncul di sini -->
                    </div>

                    <div class="text-center mb-4 text-gray-500 font-bold">Pilih Jawaban:</div>

                    <div id="jawaban-area" class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-5 w-full">
                        <!-- Jawaban akan muncul di sini -->
                    </div>
                </div>
            </div>
        </div>

        <!-- SCORE SCREEN -->
        <div id="screen-score"
            class="screen hidden opacity-0 transition-opacity duration-500 flex-col items-center justify-center w-full h-screen p-5">
            <div
                class="glass-card w-full md:w-auto md:min-w-[700px] md:max-w-3xl rounded-3xl md:rounded-[40px] shadow-2xl p-8 md:p-10 flex flex-col items-center justify-center relative animate-popIn max-h-[90vh]">
                <div class="text-center mb-6">
                    <h2 class="text-dark text-2xl font-bold m-0">HASIL AKHIR</h2>
                    <div id="final-score" class="text-7xl md:text-8xl font-black text-primary my-2 drop-shadow-sm">0
                    </div>
                    <div id="player-info" class="text-2xl text-gray-500 font-bold">Player Name</div>
                </div>

                <div class="w-full flex-1 overflow-hidden flex flex-col bg-white/50 rounded-3xl p-4 mb-6">
                    <h3 class="text-primary text-xl font-bold mb-4 flex items-center gap-2">
                        üèÜ Papan Juara
                    </h3>
                    <div id="leaderboard-list" class="w-full overflow-y-auto custom-scrollbar pr-2 flex-1">
                        <!-- List Score -->
                    </div>
                </div>

                <div class="flex gap-4">
                    <button onclick="goHome()"
                        class="bg-primary text-white px-10 py-4 text-xl font-extrabold rounded-full shadow-lg hover:-translate-y-1 hover:shadow-primary/40 active:scale-95 transition-all">
                        MAIN LAGI ‚Ü∫
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Game State
        let state = {
            level: 1,
            score: 0,
            maxLevels: 10,
            playerName: '',
            playerClass: ''
        };

        const assets = ['üçé', 'üçå', 'üçá', 'üçä', 'üçì', 'ü•ë', 'üçí', 'üçë'];

        // Navigation
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.add('hidden');
                s.classList.remove('flex');
                s.classList.remove('opacity-100');
                s.classList.add('opacity-0');
            });
            const el = document.getElementById(id);
            el.classList.remove('hidden');
            el.classList.add('flex');
            setTimeout(() => {
                el.classList.remove('opacity-0');
                el.classList.add('opacity-100');
            }, 10);
        }

        function transition(callback, text = 'SIAP... üöÄ') {
            const overlay = document.getElementById('overlay');
            const overlayText = document.getElementById('overlay-text');
            overlayText.innerText = text;

            overlay.classList.remove('translate-y-full');
            overlay.classList.add('translate-y-0');

            setTimeout(() => {
                callback();
                overlay.classList.remove('translate-y-0');
                overlay.classList.add('-translate-y-full');
            }, 600);

            setTimeout(() => {
                overlay.classList.remove('transition-transform', 'duration-[600ms]');
                overlay.classList.remove('-translate-y-full');
                overlay.classList.add('translate-y-full');
                void overlay.offsetWidth;
                overlay.classList.add('transition-transform', 'duration-[600ms]');
            }, 1200);
        }

        function mulai() {
            const nama = document.getElementById('nama').value.trim();
            const kelas = document.getElementById('kelas').value;

            if (!nama || !kelas) {
                alert("Mohon lengkapi nama dan kelas dulu ya! üòä");
                return;
            }

            state.playerName = nama;
            state.playerClass = kelas;
            state.level = 1;
            state.score = 0;

            transition(() => {
                showScreen('screen-game');
                nextLevel();
            });
        }

        function goHome() {
            transition(() => showScreen('screen-menu'));
        }

        function tutupAplikasi() {
            if (confirm("Yakin ingin keluar?")) {
                window.close();
                document.body.innerHTML = "<div class='flex justify-center items-center h-full text-white text-4xl font-bold'>Sampai Jumpa! üëã</div>";
            }
        }

        // Game Logic
        function generatePattern(n, emoji, isVertical) {
            let html = '<div class="flex flex-wrap justify-center items-center gap-1 md:gap-1.5 max-w-[120px] md:max-w-[165px]">';
            for (let i = 0; i < n; i++) {
                html += `<div class="text-2xl md:text-3xl leading-none ${isVertical ? 'rotate-90' : ''}">${emoji}</div>`;
            }
            html += '</div>';
            return html;
        }

        function nextLevel() {
            document.getElementById('level-display').innerText = state.level;
            const isHots = state.level % 3 === 0;
            const hotsBadge = document.getElementById('hots-badge');
            if (isHots) {
                hotsBadge.classList.remove('hidden');
                hotsBadge.classList.add('inline-block');
            } else {
                hotsBadge.classList.add('hidden');
                hotsBadge.classList.remove('inline-block');
            }

            const soalArea = document.getElementById('soal-area');
            const jawabArea = document.getElementById('jawaban-area');

            // Add fade out
            soalArea.style.opacity = '0';
            jawabArea.style.opacity = '0';

            setTimeout(() => {
                soalArea.innerHTML = '';
                jawabArea.innerHTML = '';

                // Logic Soal
                const emoji = assets[Math.floor(Math.random() * assets.length)];
                let sequence = [];

                let base = Math.floor(Math.random() * 3) + 1;
                let step = Math.floor(Math.random() * 2) + 1;
                let type = Math.random() > 0.5 ? 'ABAB' : 'ABCD';

                if (type === 'ABAB') {
                    sequence = [base, base + step, base, base + step];
                } else {
                    sequence = [base, base + step, base + (step * 2), base + (step * 3)];
                }

                // Render Question (First 3 items)
                for (let i = 0; i < 3; i++) {
                    let div = document.createElement('div');
                    div.className = 'flex flex-col items-center gap-1.5 md:gap-2 bg-gray-50 p-3 md:p-4 rounded-xl md:rounded-2xl border-2 border-gray-100 min-w-[90px] md:min-w-[110px] shadow-sm';
                    div.innerHTML = generatePattern(sequence[i], emoji, false);
                    div.innerHTML += `<span class="text-xs text-gray-400 font-bold">${i + 1}</span>`;
                    soalArea.appendChild(div);
                }

                // Question Mark
                let qDiv = document.createElement('div');
                qDiv.className = 'text-5xl md:text-6xl text-accent font-black animate-pulseCustom';
                qDiv.innerText = '?';
                soalArea.appendChild(qDiv);

                // Render Answers (3 options)
                let correctAnswer = sequence[3];
                let options = new Set([correctAnswer]);
                while (options.size < 3) {
                    let r = Math.max(1, correctAnswer + Math.floor(Math.random() * 5) - 2);
                    options.add(r);
                }

                Array.from(options).sort(() => Math.random() - 0.5).forEach(opt => {
                    let btn = document.createElement('div');
                    btn.className = 'bg-white border-3 md:border-4 border-transparent rounded-2xl md:rounded-3xl p-4 md:p-5 cursor-pointer transition-all duration-300 flex justify-center items-center shadow-md hover:-translate-y-2 hover:border-secondary hover:shadow-xl hover:shadow-secondary/20 min-h-[100px] md:min-h-[120px]';
                    btn.innerHTML = generatePattern(opt, emoji, false);
                    btn.onclick = () => checkAnswer(opt === correctAnswer);
                    jawabArea.appendChild(btn);
                });

                // Fade in
                setTimeout(() => {
                    soalArea.style.transition = 'opacity 0.4s ease-out';
                    jawabArea.style.transition = 'opacity 0.4s ease-out';
                    soalArea.style.opacity = '1';
                    jawabArea.style.opacity = '1';
                }, 50);
            }, 200);
        }

        function checkAnswer(isCorrect) {
            if (isCorrect) state.score += 10;

            if (state.level < state.maxLevels) {
                state.level++;
                // Show transition with level number
                transition(() => {
                    nextLevel();
                }, `LEVEL ${state.level} üéØ`);
            } else {
                finishGame();
            }
        }

        function finishGame() {
            transition(() => {
                showScreen('screen-score');
                document.getElementById('final-score').innerText = state.score;
                document.getElementById('player-info').innerText = `${state.playerName} (${state.playerClass})`;
                saveScore();
            }, 'SELESAI! üéâ');
        }

        // Leaderboard
        function saveScore() {
            let lb = JSON.parse(localStorage.getItem('nanoBananaLB')) || [];
            lb.push({
                name: state.playerName,
                cls: state.playerClass,
                score: state.score,
                date: new Date().getTime()
            });
            lb.sort((a, b) => b.score - a.score);
            localStorage.setItem('nanoBananaLB', JSON.stringify(lb.slice(0, 50)));
            renderLeaderboard();
        }

        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            const lb = JSON.parse(localStorage.getItem('nanoBananaLB')) || [];
            list.innerHTML = '';

            if (lb.length === 0) {
                list.innerHTML = '<div class="text-center p-5 text-gray-400">Belum ada data</div>';
                return;
            }

            lb.forEach((item, index) => {
                let div = document.createElement('div');
                let bgClass = index === 0 ? 'bg-gradient-to-r from-[#ffeaa7] to-[#fdcb6e] text-[#d35400] border-none' : 'bg-white text-dark';
                div.className = `flex justify-between items-center p-4 mb-3 rounded-2xl shadow-sm font-bold ${bgClass}`;

                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-sm opacity-60">#${index + 1}</span>
                        <span>${item.name} <small class="opacity-80">(${item.cls})</small></span>
                    </div>
                    <span class="text-xl font-black">${item.score}</span>
                `;
                list.appendChild(div);
            });
        }

        // Init
        window.onload = function () {
            renderLeaderboard();
            showScreen('screen-menu');
        };

    </script>
</body>

</html>