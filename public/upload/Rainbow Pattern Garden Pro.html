<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana: Rainbow Pattern Garden Pro</title>
    <style>
        :root {
            --sky: #4facfe;
            --grass: #66bb6a;
            --soft-blue: #e1f5fe;
            --rainbow: radial-gradient(circle at 50% 100%, transparent 40%, rgba(255,0,0,0.1) 45%, rgba(255,165,0,0.1) 50%, rgba(255,255,0,0.1) 55%, rgba(0,128,0,0.1) 60%, rgba(0,0,255,0.1) 65%, rgba(75,0,130,0.1) 70%, transparent 75%);
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Arial Rounded MT Bold', sans-serif;
            overflow: hidden;
            background: linear-gradient(to bottom, var(--sky) 0%, #a0e9ff 50%, var(--grass) 50%, #4caf50 100%);
        }

        /* Lansekap Alam */
        .tree { position: absolute; bottom: 5%; font-size: 15rem; z-index: 5; filter: drop-shadow(0 15px 10px rgba(0,0,0,0.2)); user-select: none; }
        .tree-left { left: 1%; }
        .tree-right { right: 1%; }

        #cloud-overlay {
            position: fixed; top: 0; left: -100%; width: 100%; height: 100%;
            background: #fff; z-index: 10000; display: flex; align-items: center; justify-content: center;
            font-size: 20rem; transition: left 0.7s ease-in-out; pointer-events: none;
        }

        .cinema-title {
            font-size: 4.5rem; color: white; text-align: center;
            text-shadow: 0 8px 0 rgba(0,0,0,0.2), 0 15px 20px rgba(0,0,0,0.3);
            margin: 10px 0; text-transform: uppercase; z-index: 10;
        }

        /* Mega Board */
        .mega-board {
            background: var(--soft-blue); background-image: var(--rainbow);
            width: 85vw; height: 78vh; border-radius: 60px; border: 15px solid #ffffff;
            box-shadow: 0 40px 60px rgba(0,0,0,0.3); display: flex; flex-direction: column;
            align-items: center; justify-content: space-around; padding: 20px; box-sizing: border-box;
            position: relative; z-index: 10;
        }

        /* Soal & Emoji Adaptif */
        .soal-grid { display: flex; justify-content: center; align-items: center; gap: 15px; width: 100%; }
        .box-pola {
            min-width: 60px; padding: 15px; background: #fff; border-radius: 30px; 
            border: 8px solid #ccc; transition: 0.3s; box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }
        .emoji-sub-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .emoji-3d { font-size: 3rem; filter: drop-shadow(3px 3px 0px rgba(0,0,0,0.15)); display: inline-block; }

        .box-target {
            width: 140px; height: 140px; background: #fff; border: 10px solid #2196f3 !important;
            color: #2196f3; font-size: 6rem; font-weight: bold; animation: pulse 1.2s infinite;
        }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.1); box-shadow: 0 0 30px rgba(33,150,243,0.4);} 100% {transform: scale(1);} }

        /* Jawaban */
        .btn-jawaban {
            width: 160px; height: 160px; background: white; border: 8px solid #ff9800;
            border-radius: 40px; cursor: pointer; box-shadow: 0 10px 0 #e68a00; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-jawaban:active { transform: translateY(6px); box-shadow: 0 4px 0 #e68a00; }

        /* Leaderboard */
        .leaderboard-container { width: 100%; display: flex; flex-direction: row; justify-content: space-around; align-items: center; }
        .score-list {
            background: rgba(255,255,255,0.9); padding: 20px; border-radius: 35px; width: 350px;
            border: 6px solid #ffca28; box-shadow: 0 10px 0 rgba(0,0,0,0.1);
        }
        .score-item {
            display: flex; justify-content: space-between; padding: 8px 12px; border-bottom: 2px dashed #eee;
            font-size: 1.2rem; color: #333;
        }
        .rank-1 { background: #fff9c4; border-radius: 15px; color: #d4af37; font-weight: bold; border-bottom: none; }

        /* UI Elements */
        input, select { padding: 15px; font-size: 1.5rem; border-radius: 25px; border: 4px solid #4facfe; width: 350px; margin: 8px; outline: none; text-align: center; }
        .btn-action { padding: 15px 60px; font-size: 2rem; border-radius: 50px; border: none; color: white; background: #ff9800; box-shadow: 0 10px 0 #c77b00; cursor: pointer; margin: 10px; }
        .btn-exit { background: #f44336; box-shadow: 0 10px 0 #b71c1c; font-size: 1.5rem; padding: 10px 40px; }
        .btn-home { position: absolute; top: 15px; left: 30px; background: #66bb6a; padding: 10px 20px; color: white; border-radius: 15px; border: none; cursor: pointer; z-index: 100; }

        .screen { display: none; flex-direction: column; align-items: center; width: 100%; }
        .active { display: flex; }
    </style>
</head>
<body>

    <div id="cloud-overlay">‚òÅÔ∏è</div>

    <div id="main-app">
        <div class="tree tree-left">üå≥</div>
        <div class="tree tree-right">üå≥</div>

        <div id="screen-menu" class="screen active">
            <h1 class="cinema-title">NANO BANANA</h1>
            <div class="mega-board">
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <input type="text" id="nama" placeholder="Tulis Namamu">
                    <select id="kelas">
                        <option value="" disabled selected>Pilih Kelas</option>
                        <option value="A">Kelas A</option>
                        <option value="B">Kelas B</option>
                        <option value="C">Kelas C</option>
                        <option value="D">Kelas D</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-action" onclick="mulai()">MAIN! üöÄ</button>
                    <button class="btn-action btn-exit" onclick="tutupAplikasi()">KELUAR ‚ùå</button>
                </div>
            </div>
        </div>

        <div id="screen-game" class="screen">
            <h1 class="cinema-title">SOAL <span id="soal-num">1</span></h1>
            <div class="mega-board">
                <button class="btn-home" onclick="goHome()">üè† HOME</button>
                <div class="soal-grid" id="soal-area"></div>
                <div class="jawaban-area" style="display:flex; gap:20px;" id="jawaban-area"></div>
            </div>
        </div>

        <div id="screen-score" class="screen">
            <h1 class="cinema-title">PAPAN JUARA</h1>
            <div class="mega-board">
                <div class="leaderboard-container">
                    <div style="text-align: center;">
                        <h2 id="apresiasi" style="font-size: 2.5rem; margin:0;"></h2>
                        <div id="total-skor" style="font-size: 8.5rem; color: #ff9800;">0</div>
                        <div style="font-size: 5rem;">üèÜ‚ú®</div>
                        <button class="btn-action" onclick="goHome()">COBA LAGI üîÑ</button>
                    </div>
                    <div class="score-list">
                        <h3 style="text-align: center; margin-top:0; color: #ff9800;">üåü 10 TERBAIK üåü</h3>
                        <div id="leaderboard-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let level = 0, skor = 0;
        const assetEmoji = [
            { emo: 'üçé', border: '#2196f3' }, { emo: 'üçå', border: '#9c27b0' },
            { emo: 'üçî', border: '#4caf50' }, { emo: 'üöÄ', border: '#e91e63' },
            { emo: 'üê±', border: '#ff5722' }, { emo: 'üç¶', border: '#3f51b5' },
            { emo: '‚≠ê', border: '#f44336' }, { emo: 'üç©', border: '#009688' },
            { emo: '‚öΩ', border: '#795548' }, { emo: 'üçì', border: '#00bcd4' }
        ];

        function transisi(fn) {
            const cloud = document.getElementById('cloud-overlay');
            cloud.style.left = '0%';
            setTimeout(() => { fn(); cloud.style.left = '100%'; }, 700);
            setTimeout(() => { cloud.style.left = '-100%'; }, 1400);
        }

        function tutupAplikasi() {
            if(confirm("Apakah kamu yakin ingin menutup game?")) {
                window.close();
                // Fallback jika window.close diblokir browser
                document.body.innerHTML = "<h1 style='color:white; text-align:center; margin-top:20%;'>Game Selesai. Silahkan tutup tab ini.</h1>";
            }
        }

        function mulai() {
            if(!document.getElementById('nama').value || !document.getElementById('kelas').value) return alert("Isi nama dan kelas!");
            skor = 0; level = 0;
            transisi(() => { show('screen-game'); buatSoal(); });
        }

        function buatSoal() {
            document.getElementById('soal-num').innerText = level + 1;
            const sArea = document.getElementById('soal-area'), jArea = document.getElementById('jawaban-area');
            sArea.innerHTML = jArea.innerHTML = '';
            const item = assetEmoji[Math.floor(Math.random() * assetEmoji.length)];
            const up = Math.random() > 0.5, step = Math.floor(Math.random() * 2) + 1;
            let start = up ? (Math.floor(Math.random() * 3) + 1) : (Math.floor(Math.random() * 3) + 9);
            let pola = [];
            for(let i=0; i<4; i++) pola.push(Math.max(1, Math.min(12, up ? start + (i * step) : start - (i * step))));

            for(let i=0; i<3; i++) {
                const box = document.createElement('div');
                box.className = 'box-pola'; box.style.borderColor = item.border;
                let subGrid = `<div class="emoji-sub-grid">`;
                for(let j=0; j<pola[i]; j++) subGrid += `<span class="emoji-3d">${item.emo}</span>`;
                box.innerHTML = subGrid + `</div>`;
                sArea.appendChild(box);
            }
            const target = document.createElement('div');
            target.className = 'box-pola box-target'; target.innerText = '?';
            sArea.appendChild(target);

            const benar = pola[3];
            let opsi = [benar, benar+1, benar-1, benar+2].filter((v, i, a) => a.indexOf(v) === i && v > 0).sort(() => Math.random() - 0.5);
            opsi.forEach(o => {
                const btn = document.createElement('button');
                btn.className = 'btn-jawaban'; btn.style.borderColor = item.border;
                let grid = `<div class="emoji-sub-grid" style="grid-template-columns:repeat(3,1fr); gap:5px;">`;
                for(let j=0; j<o; j++) grid += `<span style="font-size:1.5rem;">${item.emo}</span>`;
                btn.innerHTML = grid + `</div>`;
                btn.onclick = () => { if(o === benar) skor++; level++; if(level < 15) transisi(buatSoal); else transisi(selesai); };
                jArea.appendChild(btn);
            });
        }

        function selesai() {
            show('screen-score');
            const n = document.getElementById('nama').value, k = document.getElementById('kelas').value;
            const final = (skor * 100 / 15).toFixed(0);
            document.getElementById('apresiasi').innerText = n;
            document.getElementById('total-skor').innerText = final;
            
            let scores = JSON.parse(localStorage.getItem('nanoLeaderboard')) || [];
            scores.push({ n, s: parseInt(final), k, t: new Date().getTime() });
            scores.sort((a, b) => b.s - a.s || b.t - a.t);
            scores = scores.slice(0, 10);
            localStorage.setItem('nanoLeaderboard', JSON.stringify(scores));
            
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            scores.forEach((s, i) => {
                list.innerHTML += `<div class="score-item ${i===0?'rank-1':''}"><span>${i+1}. ${s.n} (${s.k})</span><span>${s.s}</span></div>`;
            });
        }

        function show(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function goHome() { transisi(() => show('screen-menu')); }

        window.onload = () => {
            const s = JSON.parse(localStorage.getItem('nanoLeaderboard')) || [];
            const list = document.getElementById('leaderboard-list');
            s.forEach((s, i) => {
                list.innerHTML += `<div class="score-item ${i===0?'rank-1':''}"><span>${i+1}. ${s.n} (${s.k})</span><span>${s.s}</span></div>`;
            });
        };
    </script>
</body>
</html>

