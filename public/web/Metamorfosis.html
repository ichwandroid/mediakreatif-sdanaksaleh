<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetamorQuest - Belajar Metamorfosis Seru</title>
    <style>
        :root {
            --primary-green: #4CAF50;
            --dark-green: #2E7D32;
            --accent-orange: #FF9800;
            --sky-blue: #E3F2FD;
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--sky-blue);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }

        #game-container {
            background-color: var(--white);
            width: 90%;
            max-width: 800px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            text-align: center;
            border: 4px solid var(--primary-green);
        }

        .screen { display: none; }
        .screen.active { display: block; }

        h1 { color: var(--dark-green); margin-bottom: 10px; }
        p { font-size: 1.1em; line-height: 1.6; }

        .btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            margin: 10px;
            font-weight: bold;
        }

        .btn:hover {
            background-color: var(--dark-green);
            transform: scale(1.05);
        }

        /* Game Board Styles */
        .stage-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .drop-zone {
            width: 120px;
            height: 150px;
            border: 3px dashed #ccc;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            position: relative;
        }

        .drop-zone.over { border-color: var(--primary-green); background: #f1f8e9; }

        .phase-card {
            width: 100px;
            padding: 10px;
            background: white;
            border: 2px solid var(--primary-green);
            border-radius: 10px;
            cursor: grab;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            user-select: none;
            z-index: 10;
        }

        .phase-card img {
            width: 60px;
            height: 60px;
            pointer-events: none;
        }

        .phase-label {
            font-size: 0.8em;
            font-weight: bold;
            margin-top: 5px;
            pointer-events: none;
        }

        .inventory {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 15px;
            min-height: 120px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .hud {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--dark-green);
        }

        #feedback {
            margin-top: 20px;
            font-weight: bold;
            min-height: 24px;
        }

        .success { color: var(--dark-green); }
        .error { color: #d32f2f; }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        #progress-fill {
            height: 100%;
            background: var(--primary-green);
            width: 0%;
            border-radius: 5px;
            transition: width 0.5s;
        }

        /* Tutorial/Modal Styling */
        .info-box {
            background: #fff9c4;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid var(--accent-orange);
            text-align: left;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div id="game-container">
    <!-- Layar Utama -->
    <div id="start-screen" class="screen active">
        <h1>ü¶ã MetamorQuest</h1>
        <p>Bantu para hewan melewati siklus hidupnya untuk menjaga keseimbangan alam!</p>
        <div style="font-size: 5rem; margin: 20px;">üê∏ ü¶ã ü¶ó</div>
        <button class="btn" onclick="startGame()">Mulai Petualangan</button>
    </div>

    <!-- Layar Permainan -->
    <div id="game-screen" class="screen">
        <div class="hud">
            <span id="level-title">Level 1: Kupu-kupu</span>
            <span id="score-display">Skor: 0</span>
        </div>
        <div class="progress-bar"><div id="progress-fill"></div></div>
        
        <div class="info-box" id="level-info">
            Urutkan fase hidup Kupu-kupu dari awal hingga dewasa!
        </div>

        <div class="stage-container" id="drop-zones">
            <!-- Drop zones will be generated here -->
        </div>

        <p>Tarik kartu fase di bawah ini ke kotak urutan yang benar:</p>
        <div class="inventory" id="inventory">
            <!-- Cards will be generated here -->
        </div>

        <div id="feedback"></div>
        <button class="btn" id="next-btn" style="display:none;" onclick="nextLevel()">Lanjut ke Level Berikutnya</button>
    </div>

    <!-- Layar Selesai -->
    <div id="end-screen" class="screen">
        <h1>üéâ Hebat, Penjaga Alam!</h1>
        <p>Kamu telah membantu semua hewan menyelesaikan metamorfosis mereka.</p>
        <div id="final-stats"></div>
        <button class="btn" onclick="location.reload()">Main Lagi</button>
    </div>
</div>

<script>
    const levels = [
        {
            title: "Level 1: Kupu-kupu",
            info: "Kupu-kupu mengalami <b>Metamorfosis Sempurna</b> (4 tahap).",
            animal: "Kupu-kupu",
            phases: [
                { id: 1, name: "Telur", icon: "ü•ö" },
                { id: 2, name: "Ulat (Larva)", icon: "üêõ" },
                { id: 3, name: "Kepompong (Pupa)", icon: "üì¶" },
                { id: 4, name: "Kupu-kupu (Imago)", icon: "ü¶ã" }
            ]
        },
        {
            title: "Level 2: Belalang",
            info: "Belalang mengalami <b>Metamorfosis Tidak Sempurna</b> (3 tahap). Ia tidak melalui tahap kepompong!",
            animal: "Belalang",
            phases: [
                { id: 1, name: "Telur", icon: "ü•ö" },
                { id: 2, name: "Nimfa", icon: "ü¶ó" },
                { id: 3, name: "Belalang Dewasa", icon: "ü¶ó" }
            ]
        },
        {
            title: "Level 3: Katak",
            info: "Katak memiliki metamorfosis yang unik. Mereka mulai dari air dan berakhir di darat!",
            animal: "Katak",
            phases: [
                { id: 1, name: "Telur", icon: "ü•ö" },
                { id: 2, name: "Berudu", icon: "üêü" },
                { id: 3, name: "Katak Muda", icon: "üê∏" },
                { id: 4, name: "Katak Dewasa", icon: "üê∏" }
            ]
        }
    ];

    let currentLevel = 0;
    let score = 0;
    let correctPlacements = 0;

    function startGame() {
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('game-screen').classList.add('active');
        loadLevel();
    }

    function loadLevel() {
        const level = levels[currentLevel];
        document.getElementById('level-title').innerText = level.title;
        document.getElementById('level-info').innerHTML = level.info;
        document.getElementById('feedback').innerText = "";
        document.getElementById('next-btn').style.display = "none";
        
        correctPlacements = 0;
        const progress = (currentLevel / levels.length) * 100;
        document.getElementById('progress-fill').style.width = progress + "%";

        // Setup Drop Zones
        const dropZonesContainer = document.getElementById('drop-zones');
        dropZonesContainer.innerHTML = "";
        level.phases.forEach((_, index) => {
            const zone = document.createElement('div');
            zone.className = 'drop-zone';
            zone.dataset.index = index + 1;
            zone.innerHTML = `<span>Tahap ${index + 1}</span>`;
            
            zone.addEventListener('dragover', e => e.preventDefault());
            zone.addEventListener('dragenter', e => zone.classList.add('over'));
            zone.addEventListener('dragleave', e => zone.classList.remove('over'));
            zone.addEventListener('drop', handleDrop);
            
            dropZonesContainer.appendChild(zone);
        });

        // Setup Inventory (Shuffled Cards)
        const inventory = document.getElementById('inventory');
        inventory.innerHTML = "";
        const shuffledPhases = [...level.phases].sort(() => Math.random() - 0.5);
        
        shuffledPhases.forEach(phase => {
            const card = document.createElement('div');
            card.className = 'phase-card';
            card.draggable = true;
            card.id = `phase-${phase.id}`;
            card.dataset.id = phase.id;
            card.innerHTML = `
                <div style="font-size: 2.5rem">${phase.icon}</div>
                <div class="phase-label">${phase.name}</div>
            `;
            
            card.addEventListener('dragstart', e => {
                e.dataTransfer.setData('text/plain', card.id);
                setTimeout(() => card.style.opacity = "0.5", 0);
            });
            
            card.addEventListener('dragend', () => card.style.opacity = "1");
            
            inventory.appendChild(card);
        });
    }

    function handleDrop(e) {
        e.preventDefault();
        this.classList.remove('over');
        const cardId = e.dataTransfer.getData('text/plain');
        const card = document.getElementById(cardId);
        const feedback = document.getElementById('feedback');
        
        const targetIndex = parseInt(this.dataset.index);
        const phaseId = parseInt(card.dataset.id);

        if (this.children.length > 1) return; // Zone already occupied

        if (phaseId === targetIndex) {
            this.appendChild(card);
            card.draggable = false;
            card.style.cursor = "default";
            card.style.borderColor = "#2E7D32";
            card.style.background = "#E8F5E9";
            
            feedback.innerText = "Bagus! Itu urutan yang benar.";
            feedback.className = "success";
            
            score += 10;
            document.getElementById('score-display').innerText = `Skor: ${score}`;
            correctPlacements++;

            checkWin();
        } else {
            feedback.innerText = "Ups! Kurang tepat. Coba urutan lain.";
            feedback.className = "error";
            score = Math.max(0, score - 2);
            document.getElementById('score-display').innerText = `Skor: ${score}`;
        }
    }

    function checkWin() {
        const level = levels[currentLevel];
        if (correctPlacements === level.phases.length) {
            document.getElementById('feedback').innerHTML = "üåü Sempurna! Level Selesai! üåü";
            document.getElementById('next-btn').style.display = "inline-block";
            
            if (currentLevel === levels.length - 1) {
                document.getElementById('next-btn').innerText = "Lihat Hasil Akhir";
            }
        }
    }

    function nextLevel() {
        currentLevel++;
        if (currentLevel < levels.length) {
            loadLevel();
        } else {
            showEndScreen();
        }
    }

    function showEndScreen() {
        document.getElementById('game-screen').classList.remove('active');
        document.getElementById('end-screen').classList.add('active');
        document.getElementById('progress-fill').style.width = "100%";
        document.getElementById('final-stats').innerHTML = `
            <h2>Skor Akhir Kamu: ${score}</h2>
            <p>Kamu sekarang sudah paham perbedaan Metamorfosis Sempurna dan Tidak Sempurna!</p>
        `;
    }
</script>

</body>
</html>