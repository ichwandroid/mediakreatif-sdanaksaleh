<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petualangan Identitas - Kelas 1 SD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-main: #E0F2FE;
            --accent-yellow: #FEF3C7;
            --accent-pink: #FCE7F3;
            --primary-blue: #3B82F6;
        }
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-main);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(254, 243, 199, 0.5) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(252, 231, 243, 0.5) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(224, 242, 254, 1) 0%, rgba(186, 230, 253, 0.5) 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #1E293B;
            position: relative;
            overflow-x: hidden;
        }

        /* Dekorasi Latar Belakang */
        body::before {
            content: "‚òÅÔ∏è";
            position: fixed;
            top: 50px;
            left: 5%;
            font-size: 4rem;
            opacity: 0.4;
            animation: float 10s infinite ease-in-out;
        }
        body::after {
            content: "‚òÅÔ∏è";
            position: fixed;
            bottom: 100px;
            right: 5%;
            font-size: 5rem;
            opacity: 0.4;
            animation: float 8s infinite ease-in-out reverse;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            50% { transform: translateY(-20px) translateX(10px); }
        }

        h1, h2, h3, .font-kids {
            font-family: 'Fredoka One', cursive;
            letter-spacing: 0.5px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            box-shadow: 0 20px 50px -15px rgba(59, 130, 246, 0.15);
            border: 4px solid #FFFFFF;
        }

        .option-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 3px solid #F1F5F9;
            background: white;
            position: relative;
        }

        .option-card:hover {
            transform: translateY(-5px) rotate(1deg);
            border-color: #3B82F6;
            box-shadow: 0 10px 20px -5px rgba(59, 130, 246, 0.2);
        }

        .option-selected {
            border-color: #10B981 !important;
            background-color: #F0FDF4 !important;
            transform: scale(1.05) !important;
        }

        .btn-main {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            border-bottom: 6px solid #1E40AF;
            transition: all 0.2s;
        }

        .btn-main:active {
            border-bottom-width: 0px;
            transform: translateY(6px);
        }

        .progress-container {
            height: 16px;
            background-color: #F1F5F9;
            border-radius: 20px;
            border: 2px solid #E2E8F0;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FBBF24, #F59E0B);
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #BFDBFE;
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        
        <!-- SECTION 1: BERANDA -->
        <div id="screen-home" class="max-w-2xl mx-auto glass-card p-12 text-center fade-in">
            <div class="flex justify-between items-center mb-8">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">üáÆüá©</span>
                    <span class="bg-yellow-400 text-yellow-900 px-4 py-1 rounded-full text-[10px] font-extrabold uppercase tracking-widest">Kelas 1 SD</span>
                </div>
                <button onclick="openGuruMode()" class="p-2 bg-white/50 hover:bg-blue-100 rounded-2xl transition flex items-center gap-2 group border-2 border-dashed border-blue-200">
                    <span class="text-[10px] font-bold text-blue-400">GURU</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </button>
            </div>
            
            <div class="relative inline-block mb-8">
                <div class="absolute -top-4 -right-4 text-4xl animate-bounce">‚ú®</div>
                <div class="p-8 bg-gradient-to-tr from-blue-100 to-white rounded-full shadow-inner border-4 border-white">
                    <span class="text-8xl">üë¶üèª</span>
                </div>
            </div>
            
            <h1 class="text-4xl md:text-5xl text-blue-600 mb-4 drop-shadow-sm">Halo Sahabat!</h1>
            <p class="text-slate-500 mb-12 text-xl font-medium">Ayo buat kartu identitasmu sendiri!</p>
            
            <div class="space-y-8 text-left mb-12">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="group">
                        <label class="block text-sm font-bold text-blue-400 mb-3 ml-2 flex items-center gap-2">
                            <span>üè´</span> KELAS KAMU
                        </label>
                        <select id="input-kelas" class="w-full p-5 rounded-[24px] border-4 border-slate-50 bg-slate-50 focus:bg-white focus:border-blue-300 outline-none transition-all text-lg font-bold text-slate-700 appearance-none shadow-sm">
                            <option value="1A">Kelas 1 - A</option>
                            <option value="1B">Kelas 1 - B</option>
                            <option value="1C">Kelas 1 - C</option>
                            <option value="1D">Kelas 1 - D</option>
                        </select>
                    </div>
                    <div class="group">
                        <label class="block text-sm font-bold text-blue-400 mb-3 ml-2 flex items-center gap-2">
                            <span>üìõ</span> NAMA PANGGILAN
                        </label>
                        <input type="text" id="input-nama" placeholder="Tulis namamu..." class="w-full p-5 rounded-[24px] border-4 border-slate-50 bg-slate-50 focus:bg-white focus:border-blue-300 outline-none transition-all text-lg font-bold shadow-sm">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-bold text-blue-400 mb-3 ml-2 flex items-center gap-2">
                        <span>üìç</span> ASAL SEKOLAH
                    </label>
                    <input type="text" id="input-sekolah" placeholder="Nama SD tempat kamu belajar..." class="w-full p-5 rounded-[24px] border-4 border-slate-50 bg-slate-50 focus:bg-white focus:border-blue-300 outline-none transition-all text-lg font-bold shadow-sm">
                </div>
            </div>

            <button onclick="goToMenu()" class="w-full btn-main text-white font-bold py-6 rounded-[30px] shadow-2xl shadow-blue-300 text-2xl tracking-widest uppercase">
                MULAI SEKARANG üöÄ
            </button>
        </div>

        <!-- SECTION 2: MENU UTAMA -->
        <div id="screen-menu" class="max-w-2xl mx-auto hidden glass-card p-12 text-center fade-in">
            <h2 class="text-4xl text-slate-800 mb-4">Pilih Misi Seru</h2>
            <div id="welcome-msg" class="mb-12 py-3 px-8 bg-blue-500 text-white font-bold rounded-full inline-block shadow-lg shadow-blue-100"></div>

            <div class="grid grid-cols-1 gap-6 text-left">
                <div onclick="showScreen('materi')" class="group flex items-center p-8 glass-card border-b-8 border-yellow-400 hover:scale-[1.02] cursor-pointer transition-all">
                    <div class="w-20 h-20 bg-yellow-100 rounded-[28px] flex items-center justify-center text-4xl mr-8 group-hover:rotate-12 transition">üìö</div>
                    <div>
                        <h3 class="text-2xl font-bold text-slate-700">Ayo Belajar</h3>
                        <p class="text-slate-400 font-bold">Mengenal diriku dan teman</p>
                    </div>
                </div>

                <div onclick="startQuiz1()" class="group flex items-center p-8 glass-card border-b-8 border-emerald-400 hover:scale-[1.02] cursor-pointer transition-all">
                    <div class="w-20 h-20 bg-emerald-100 rounded-[28px] flex items-center justify-center text-4xl mr-8 group-hover:rotate-12 transition">‚≠ê</div>
                    <div>
                        <h3 class="text-2xl font-bold text-slate-700">Kuis Pintar</h3>
                        <p class="text-slate-400 font-bold">Uji kemampuanmu di sini</p>
                    </div>
                </div>

                <div onclick="showScreen('kuis2')" class="group flex items-center p-8 glass-card border-b-8 border-purple-400 hover:scale-[1.02] cursor-pointer transition-all">
                    <div class="w-20 h-20 bg-purple-100 rounded-[28px] flex items-center justify-center text-4xl mr-8 group-hover:rotate-12 transition">üñçÔ∏è</div>
                    <div>
                        <h3 class="text-2xl font-bold text-slate-700">Tantangan Menulis</h3>
                        <p class="text-slate-400 font-bold">Lengkapi data profilmu</p>
                    </div>
                </div>
            </div>
            
            <button onclick="showScreen('home')" class="mt-12 text-sm text-slate-400 font-bold hover:text-red-500 transition-colors flex items-center justify-center gap-2 mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                GANTI SISWA
            </button>
        </div>

        <!-- SECTION GURU: DASHBOARD MODERN -->
        <div id="screen-guru" class="hidden fade-in space-y-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                <div>
                    <h2 class="text-4xl font-bold text-slate-800">Ruang Guru üè´</h2>
                    <p class="text-slate-500 font-bold">Pantau prestasi siswa di sini</p>
                </div>
                <div class="flex gap-4">
                    <button onclick="exportData()" class="bg-white text-blue-600 px-6 py-4 rounded-[24px] font-bold shadow-xl shadow-blue-100 border-2 border-blue-50 hover:bg-blue-50 transition flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        UNDUH DATA (CSV)
                    </button>
                    <button onclick="showScreen('home')" class="bg-slate-900 text-white px-8 py-4 rounded-[24px] font-bold shadow-2xl hover:bg-slate-800 transition">
                        KELUAR
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="glass-card p-8 border-b-8 border-blue-500">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-4xl">üë•</span>
                        <div id="stat-total" class="text-4xl font-bold text-blue-600">0</div>
                    </div>
                    <div class="text-sm text-slate-400 font-extrabold uppercase tracking-widest">Total Siswa</div>
                </div>
                <div class="glass-card p-8 border-b-8 border-emerald-500">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-4xl">üìä</span>
                        <div id="stat-avg" class="text-4xl font-bold text-emerald-600">0</div>
                    </div>
                    <div class="text-sm text-slate-400 font-extrabold uppercase tracking-widest">Rata-rata Nilai</div>
                </div>
                <div class="glass-card p-8 border-b-8 border-yellow-500">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-4xl">üèÜ</span>
                        <div id="stat-max" class="text-4xl font-bold text-yellow-600">0</div>
                    </div>
                    <div class="text-sm text-slate-400 font-extrabold uppercase tracking-widest">Skor Tertinggi</div>
                </div>
            </div>

            <div class="glass-card overflow-hidden">
                <div class="p-8 border-b border-slate-100 flex flex-col md:flex-row justify-between items-center gap-6 bg-white/50">
                    <h3 class="text-2xl font-bold text-slate-700">Daftar Nilai Siswa</h3>
                    <div class="flex items-center gap-4 bg-white p-2 rounded-2xl border-2 border-slate-100 shadow-sm">
                        <span class="text-xs font-black text-slate-400 ml-2 uppercase">Kelas:</span>
                        <select id="filter-kelas" onchange="renderBankNilai()" class="bg-transparent font-bold text-blue-600 outline-none pr-4">
                            <option value="ALL">Semua Kelas</option>
                            <option value="1A">Kelas 1A</option>
                            <option value="1B">Kelas 1B</option>
                            <option value="1C">Kelas 1C</option>
                            <option value="1D">Kelas 1D</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto custom-scroll">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="text-[11px] text-slate-400 uppercase tracking-widest bg-slate-50/50">
                                <th class="py-6 px-8">Nama & Sekolah</th>
                                <th class="py-6 px-8">Kelas</th>
                                <th class="py-6 px-8 text-center">Hasil Kuis</th>
                                <th class="py-6 px-8">Profil Isian</th>
                                <th class="py-6 px-8 text-right">Tindakan</th>
                            </tr>
                        </thead>
                        <tbody id="table-nilai" class="divide-y divide-slate-50"></tbody>
                    </table>
                </div>
                <div id="empty-state" class="hidden py-32 text-center bg-white/30">
                    <div class="text-8xl mb-6">üèùÔ∏è</div>
                    <p class="text-slate-400 text-xl font-bold">Wah, belum ada data siswa yang masuk nih!</p>
                </div>
            </div>
        </div>

        <!-- MATERI SECTION -->
        <div id="screen-materi" class="max-w-2xl mx-auto hidden glass-card p-12 fade-in">
            <div class="flex items-center mb-10">
                <button onclick="showScreen('menu')" class="mr-6 p-4 bg-blue-50 hover:bg-blue-100 rounded-[20px] transition-colors border-2 border-blue-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
                <h2 class="text-3xl font-bold text-slate-800">Ruang Belajar</h2>
            </div>
            
            <div class="space-y-8">
                <div class="bg-gradient-to-br from-blue-500 to-blue-700 p-10 rounded-[40px] text-white shadow-xl relative overflow-hidden">
                    <div class="absolute -right-4 -bottom-4 text-8xl opacity-20">üìñ</div>
                    <p class="text-2xl leading-relaxed font-bold mb-4">Apa itu Identitas Diri?</p>
                    <p class="text-lg opacity-90 leading-relaxed font-medium">
                        Identitas diri adalah "KTP" kecilmu! Ini caramu memberitahu orang lain namamu, di mana kamu tinggal, dan apa yang kamu sukai.
                    </p>
                </div>
                
                <div class="grid grid-cols-1 gap-6">
                    <div class="flex items-center p-6 bg-white border-4 border-yellow-50 rounded-[30px] shadow-sm hover:border-yellow-200 transition">
                        <div class="w-16 h-16 bg-yellow-100 rounded-2xl flex items-center justify-center text-3xl mr-6">üè∑Ô∏è</div>
                        <div class="text-slate-700 font-bold text-xl">Nama & Panggilan</div>
                    </div>
                    <div class="flex items-center p-6 bg-white border-4 border-blue-50 rounded-[30px] shadow-sm hover:border-blue-200 transition">
                        <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center text-3xl mr-6">üè†</div>
                        <div class="text-slate-700 font-bold text-xl">Rumah & Keluarga</div>
                    </div>
                </div>
            </div>
            <button onclick="showScreen('menu')" class="mt-12 w-full btn-main text-white font-bold py-6 rounded-[30px] shadow-xl text-xl uppercase tracking-widest">SAYA SUDAH PINTAR! üåü</button>
        </div>

        <!-- KUIS SECTION -->
        <div id="screen-kuis1" class="max-w-2xl mx-auto hidden glass-card p-10 fade-in overflow-hidden border-t-[12px] border-emerald-400">
            <div class="mb-12">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <h4 class="text-emerald-500 font-black text-xs tracking-[0.2em] uppercase" id="quiz-progress-text">SOAL 1 DARI 10</h4>
                        <div class="text-slate-400 font-bold">Pilih jawaban yang paling benar ya!</div>
                    </div>
                    <div class="text-3xl font-black text-emerald-500" id="quiz-percentage">10%</div>
                </div>
                <div class="progress-container">
                    <div id="quiz-progress-fill" class="progress-bar-fill"></div>
                </div>
            </div>
            
            <div id="quiz1-content" class="min-h-[400px]"></div>
            
            <div class="flex gap-6 mt-12">
                <button id="btn-prev" onclick="prevQuestion()" class="flex-1 bg-slate-100 text-slate-400 font-bold py-5 rounded-[28px] hover:bg-slate-200 transition-colors disabled:opacity-30">KEMBALI</button>
                <button id="btn-next" onclick="nextQuestion()" class="flex-1 bg-emerald-500 text-white font-bold py-5 rounded-[28px] shadow-xl shadow-emerald-100 hover:bg-emerald-600 transition-colors">LANJUTKAN</button>
            </div>
        </div>

        <!-- TANTANGAN MENULIS SECTION -->
        <div id="screen-kuis2" class="max-w-2xl mx-auto hidden glass-card p-12 fade-in border-t-[12px] border-purple-400">
            <h2 class="text-4xl text-center text-slate-800 mb-4">Tantangan Menulis</h2>
            <p class="text-center text-slate-400 font-bold mb-12">Ayo belajar mengetik di keyboard!</p>
            
            <div class="space-y-10">
                <div>
                    <label class="block text-xs font-black text-purple-400 mb-4 tracking-[0.2em] uppercase">1. Tulis Nama Lengkap Kamu:</label>
                    <input type="text" id="ans-1" placeholder="Ketik di sini..." class="w-full p-6 rounded-[30px] border-4 border-purple-50 bg-purple-50/50 focus:bg-white focus:border-purple-300 outline-none transition-all text-xl font-bold shadow-inner">
                </div>
                <div>
                    <label class="block text-xs font-black text-purple-400 mb-4 tracking-[0.2em] uppercase">2. Apa Hobi Kesukaanmu?</label>
                    <input type="text" id="ans-2" placeholder="Main bola, menggambar, dll..." class="w-full p-6 rounded-[30px] border-4 border-purple-50 bg-purple-50/50 focus:bg-white focus:border-purple-300 outline-none transition-all text-xl font-bold shadow-inner">
                </div>
            </div>
            <button onclick="submitWriting()" class="mt-16 w-full bg-purple-600 text-white font-bold py-6 rounded-[30px] shadow-2xl shadow-purple-200 hover:bg-purple-700 transition-colors text-xl uppercase tracking-widest">SIMPAN PROFILKU ‚ú®</button>
            <button onclick="showScreen('menu')" class="mt-6 block w-full text-center text-slate-400 font-bold hover:text-slate-600">BATALKAN</button>
        </div>

        <!-- HASIL KUIS SECTION -->
        <div id="screen-result" class="max-w-2xl mx-auto hidden glass-card p-16 text-center fade-in">
            <div id="result-icon" class="text-9xl mb-8">üèÜ</div>
            <h2 id="result-title" class="text-5xl font-bold text-slate-800 mb-4">Hebat Sekali!</h2>
            <p id="result-desc" class="text-slate-400 font-bold mb-12 text-xl">Kamu sudah menyelesaikan tantangan ini!</p>
            
            <div class="flex justify-center mb-16">
                <div class="relative w-56 h-56 flex items-center justify-center">
                    <svg class="absolute inset-0 w-full h-full transform -rotate-90">
                        <circle cx="112" cy="112" r="100" stroke="#F1F5F9" stroke-width="20" fill="transparent" />
                        <circle id="result-circle" cx="112" cy="112" r="100" stroke="#10B981" stroke-width="20" fill="transparent" stroke-dasharray="628.3" stroke-dashoffset="628.3" style="transition: stroke-dashoffset 2s cubic-bezier(0.4, 0, 0.2, 1); stroke-linecap: round;" />
                    </svg>
                    <div class="text-center z-10">
                        <span id="result-score" class="text-7xl font-bold text-slate-800">0</span>
                        <div class="text-sm font-black text-slate-400 uppercase tracking-widest">SKOR</div>
                    </div>
                </div>
            </div>
            
            <button onclick="showScreen('menu')" class="w-full btn-main text-white font-bold py-6 rounded-[30px] shadow-2xl text-2xl uppercase tracking-widest">KEMBALI KE MENU</button>
        </div>

        <!-- MODAL FEEDBACK -->
        <div id="modal-msg" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-6 z-50">
            <div class="bg-white p-12 rounded-[50px] text-center max-w-sm w-full shadow-2xl scale-110 border-8 border-blue-50">
                <div id="modal-icon" class="text-8xl mb-6">üéà</div>
                <h3 id="modal-title" class="text-3xl font-bold mb-4">Hore!</h3>
                <p id="modal-text" class="text-slate-500 mb-10 text-lg font-medium"></p>
                <button onclick="closeModal()" class="w-full btn-main text-white py-5 rounded-[24px] font-bold text-xl uppercase tracking-widest shadow-lg">LANJUT!</button>
            </div>
        </div>

    </div>

    <script>
        let userData = {};
        let teacherData = JSON.parse(localStorage.getItem('bank_nilai_v4')) || [];
        
        const quiz1Questions = [
            { q: "Apa sebutan untuk keterangan tentang diri kita sendiri?", a: "Identitas Diri", b: "Identitas Hewan", c: "Identitas Benda", correct: "a" },
            { q: "Nama panggilan gunanya supaya teman lebih mudah...", a: "Melupakan kita", b: "Memanggil kita", c: "Menyakiti kita", correct: "b" },
            { q: "Warna kesukaan dan hobi setiap anak biasanya...", a: "Harus sama", b: "Berbeda-beda", c: "Selalu buruk", correct: "b" },
            { q: "Rumah adalah tempat kita...", a: "Sekolah", b: "Tinggal & Istirahat", c: "Membeli Jajan", correct: "b" },
            { q: "Kalau kita berkenalan dengan teman baru, hati kita...", a: "Sedih", b: "Senang", c: "Takut", correct: "b" },
            { q: "Ciri fisik seperti rambut keriting atau lurus adalah...", a: "Pemberian Tuhan", b: "Bisa dibuang", c: "Sangat buruk", correct: "a" },
            { q: "Nama Ayah dan Ibu adalah bagian dari identitas...", a: "Pribadi", b: "Keluarga", c: "Benda", correct: "b" },
            { q: "Menyapa teman yang baru kenal adalah perbuatan...", a: "Nakal", b: "Terpuji", c: "Lucu", correct: "b" },
            { q: "Apa yang kita sebutkan saat mengenalkan diri?", a: "Harga Sepatu", b: "Nama & Alamat", c: "Merek Tas", correct: "b" },
            { q: "Identitas diri penting supaya kita bisa...", a: "Saling mengenal", b: "Saling bermusuhan", c: "Saling berteriak", correct: "a" }
        ];

        let currentQIndex = 0;
        let userAnswers = Array(quiz1Questions.length).fill(null);

        function showScreen(screenId) {
            document.querySelectorAll('#app > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(`screen-${screenId}`).classList.remove('hidden');
            
            // Adjust container width
            if(['home', 'menu', 'materi', 'kuis1', 'kuis2', 'result'].includes(screenId)) {
                document.getElementById('app').classList.replace('max-w-4xl', 'max-w-2xl');
            } else {
                document.getElementById('app').classList.replace('max-w-2xl', 'max-w-4xl');
            }
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function showModal(title, text, icon, colorClass = "text-blue-500") {
            const modal = document.getElementById('modal-msg');
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-title').className = `text-3xl font-bold mb-4 ${colorClass}`;
            document.getElementById('modal-text').innerText = text;
            document.getElementById('modal-icon').innerText = icon;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-msg').classList.add('hidden');
        }

        function goToMenu() {
            const nama = document.getElementById('input-nama').value;
            const sekolah = document.getElementById('input-sekolah').value;
            if (!nama || !sekolah) {
                showModal("Halo!", "Jangan lupa isi namamu dan sekolahmu dulu ya, Sahabat!", "üë¶üèª", "text-blue-500");
                return;
            }
            userData = { 
                nama, 
                kelas: document.getElementById('input-kelas').value, 
                sekolah, 
                skorPG: 0,
                isian: ""
            };
            document.getElementById('welcome-msg').innerText = `Halo, ${userData.nama}!`;
            showScreen('menu');
        }

        function startQuiz1() {
            currentQIndex = 0;
            userAnswers = Array(quiz1Questions.length).fill(null);
            renderQuiz1();
            showScreen('kuis1');
        }

        function renderQuiz1() {
            const item = quiz1Questions[currentQIndex];
            const container = document.getElementById('quiz1-content');
            const perc = ((currentQIndex + 1) / quiz1Questions.length) * 100;
            document.getElementById('quiz-progress-text').innerText = `SOAL ${currentQIndex + 1} DARI 10`;
            document.getElementById('quiz-percentage').innerText = `${Math.round(perc)}%`;
            document.getElementById('quiz-progress-fill').style.width = `${perc}%`;

            container.innerHTML = `
                <div class="fade-in">
                    <h3 class="text-3xl font-bold text-slate-800 mb-12 leading-tight">${item.q}</h3>
                    <div class="space-y-6">
                        ${['a', 'b', 'c'].map(opt => `
                            <div onclick="selectOption('${opt}')" class="option-card p-6 rounded-[30px] flex items-center ${userAnswers[currentQIndex] === opt ? 'option-selected shadow-inner' : 'shadow-sm'}">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center font-black mr-6 text-lg ${userAnswers[currentQIndex] === opt ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-400'}">
                                    ${opt.toUpperCase()}
                                </div>
                                <span class="text-xl text-slate-700 font-bold">${item[opt]}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            document.getElementById('btn-prev').disabled = currentQIndex === 0;
            document.getElementById('btn-next').innerText = currentQIndex === (quiz1Questions.length - 1) ? "SELESAI" : "LANJUT";
        }

        function selectOption(opt) {
            userAnswers[currentQIndex] = opt;
            renderQuiz1();
        }

        function nextQuestion() {
            if (!userAnswers[currentQIndex]) {
                showModal("Eits!", "Pilih satu jawaban dulu sebelum lanjut ya!", "üí°", "text-yellow-500");
                return;
            }
            if (currentQIndex < quiz1Questions.length - 1) {
                currentQIndex++;
                renderQuiz1();
            } else {
                finishQuiz1();
            }
        }

        function prevQuestion() {
            if (currentQIndex > 0) {
                currentQIndex--;
                renderQuiz1();
            }
        }

        function finishQuiz1() {
            let correctCount = 0;
            userAnswers.forEach((ans, idx) => {
                if (ans === quiz1Questions[idx].correct) correctCount++;
            });
            const score = Math.round((correctCount / quiz1Questions.length) * 100);
            userData.skorPG = score;
            document.getElementById('result-score').innerText = score;
            const circleLength = 628.3; 
            const offset = circleLength - (circleLength * score / 100);
            
            if (score >= 80) {
                document.getElementById('result-title').innerText = "Hebat Sekali!";
                document.getElementById('result-icon').innerText = "ü•á";
                confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
            } else {
                document.getElementById('result-title').innerText = "Bagus!";
                document.getElementById('result-icon').innerText = "‚≠ê";
            }
            saveToBank();
            showScreen('result');
            setTimeout(() => { document.getElementById('result-circle').style.strokeDashoffset = offset; }, 100);
        }

        function submitWriting() {
            const a1 = document.getElementById('ans-1').value;
            const a2 = document.getElementById('ans-2').value;
            if (!a1 || !a2) {
                showModal("Lengkapi Yuk!", "Tulis namamu dan hobimu dengan lengkap ya!", "‚úçÔ∏è", "text-purple-500");
                return;
            }
            userData.isian = `Nama: ${a1} | Hobi: ${a2}`;
            showModal("Hore!", "Profil kamu sudah tersimpan dengan aman!", "üåà", "text-purple-600");
            saveToBank();
            setTimeout(() => showScreen('menu'), 2000);
        }

        function saveToBank() {
            const index = teacherData.findIndex(d => d.nama === userData.nama && d.kelas === userData.kelas);
            if (index > -1) teacherData[index] = {...userData};
            else teacherData.push({...userData});
            localStorage.setItem('bank_nilai_v4', JSON.stringify(teacherData));
        }

        function openGuruMode() {
            const pin = prompt("üîê Kode Rahasia Guru (PIN: 1234):");
            if (pin === "1234") {
                renderBankNilai();
                showScreen('guru');
            } else if(pin !== null) {
                alert("Kode Salah!");
            }
        }

        function renderBankNilai() {
            const filter = document.getElementById('filter-kelas').value;
            const tbody = document.getElementById('table-nilai');
            const emptyState = document.getElementById('empty-state');
            
            const filteredData = filter === 'ALL' 
                ? teacherData 
                : teacherData.filter(d => d.kelas === filter);

            tbody.innerHTML = "";
            
            if (filteredData.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                filteredData.forEach((data, idx) => {
                    const originalIdx = teacherData.indexOf(data);
                    tbody.innerHTML += `
                        <tr class="hover:bg-blue-50/30 transition group">
                            <td class="py-6 px-8">
                                <div class="font-bold text-slate-800 text-lg">${data.nama}</div>
                                <div class="text-xs text-slate-400 font-extrabold uppercase">${data.sekolah}</div>
                            </td>
                            <td class="py-6 px-8">
                                <span class="bg-white border-2 border-slate-100 text-slate-600 px-4 py-1.5 rounded-full text-xs font-black">${data.kelas}</span>
                            </td>
                            <td class="py-6 px-8 text-center">
                                <span class="inline-block min-w-[50px] py-2 rounded-2xl font-black text-lg ${data.skorPG >= 70 ? 'text-emerald-500' : 'text-red-400'}">
                                    ${data.skorPG || 0}
                                </span>
                            </td>
                            <td class="py-6 px-8 max-w-[250px]">
                                <div class="text-sm text-slate-500 line-clamp-2 font-medium italic bg-slate-50 p-3 rounded-2xl border border-slate-100">${data.isian || '---'}</div>
                            </td>
                            <td class="py-6 px-8 text-right">
                                <button onclick="deleteNilai(${originalIdx})" class="opacity-0 group-hover:opacity-100 bg-red-50 text-red-400 hover:text-red-600 hover:bg-red-100 p-3 rounded-2xl transition shadow-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            updateStats(filteredData);
        }

        function updateStats(data) {
            document.getElementById('stat-total').innerText = data.length;
            if (data.length > 0) {
                const avg = Math.round(data.reduce((acc, curr) => acc + (curr.skorPG || 0), 0) / data.length);
                const max = Math.max(...data.map(d => d.skorPG || 0));
                document.getElementById('stat-avg').innerText = avg;
                document.getElementById('stat-max').innerText = max;
            } else {
                document.getElementById('stat-avg').innerText = "0";
                document.getElementById('stat-max').innerText = "0";
            }
        }

        function deleteNilai(idx) {
            if(confirm("Hapus data nilai siswa ini?")) {
                teacherData.splice(idx, 1);
                localStorage.setItem('bank_nilai_v4', JSON.stringify(teacherData));
                renderBankNilai();
            }
        }
        
        function exportData() {
            if (teacherData.length === 0) {
                alert("Tidak ada data untuk diekspor!");
                return;
            }
            const csvContent = "data:text/csv;charset=utf-8,Nama,Kelas,Sekolah,Skor PG,Isian\n" 
                + teacherData.map(d => `"${d.nama}","${d.kelas}","${d.sekolah}",${d.skorPG},"${d.isian}"`).join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Data_Nilai_Pancasila_${new Date().toLocaleDateString()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>